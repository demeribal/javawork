<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form id="orderform">
        <div>
            <label for="quantity">수량</label>
            <input type="number" name="quantity" id="quantity">
        </div>
        <div>
            <input type="submit" value="발주하기">
        </div>
    </form>

    <table border="1">
        <thead>
            <tr>
                <th>id</th>
                <th>발주상태</th>
                <th>발주량</th>
                <th>마지막 업데이트</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
    <script>
        const orderlist = fetchOrderList();
        const orderform=document.getElementById("orderform");
        
        orderform.addEventListener("submit",function(event){
            event.preventDefault();

            let formDate=new FormData();
            formDate.append("quantity",quantity.value);
            console.log(formDate);
            console.log(formDate.get("quantity"));

            fetch("http://localhost:8080/api/order",{
                method: "POST",
                body: formDate,
            })
            .then(response=>{
                if(!response.ok){throw new Error("에러발생");
                }
                return response.json();
            }).then(data=>{
                console.log(data)
            })
            .catch(error=>{});
        });



        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2, "0")}-${date.getDate().toString().padStart(2, "0")}`;
        }

        function fetchOrderList() {
            fetch("http://localhost:8080/api/orders")
            .then(response=>{
                if(!response.ok){throw new Error("에러발생");
                }
                return response.json();
            })
            .then(data=>{
                const tbody=document.getElementById("tbody");
                tbody.innerHTML="";

                let orders = data.orders;
                orders.forEach((order) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${order.id}</td>
                        <td>${order.status}</td>
                        <td>${order.quantity}</td>
                        <td>${formatDate(order.lastUpdate)}</td>
                    `;
                    tbody.appendChild(row);
                });

                setTimeout(fetchOrderList, 1000);
            })
            .catch(error=>{console.error("발주 데이터 불러오기 실패:", error)});        
        }
    </script>
</body>
</html>