<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kiosk.stock.header.mapper.StockHeaderMapper">

    <resultMap id="stockHeaderResultMap" type="com.kiosk.stock.header.DTO.StockHeaderDTO">
        <id property="id" column="id"/>
        <result property="officeName" column="office_name"/>
        <result property="menuName" column="menuName"/>
        <result property="quantity" column="quantity"/>
        <result property="isUse" column="is_use"/>
        <result property="status" column="status"/>
        <result property="lastUpdate" column="last_update"/>
    </resultMap>

    <!-- StockHeader 단건 조회 -->
    <select id="getStockHeaderById" parameterType="int" resultMap="stockHeaderResultMap">
        SELECT
            s.id,
            o.office_name,
            m.menuName,
            s.quantity,
            s.is_use,
            ob.status,
            ob.last_update
        FROM stock s
        LEFT JOIN office o ON s.office_id = o.id
        LEFT JOIN menu m ON s.menu_id = m.id
        LEFT JOIN orders ob ON s.order_id = ob.id
        WHERE s.id = #{id}
    </select>

    <!-- StockHeader 전체 조회 -->
    <select id="getAllStockHeaders" resultMap="stockHeaderResultMap">
        SELECT
            s.id,
            o.office_name,
            m.menuName,
            s.quantity,
            s.is_use,
            ob.status,
            ob.last_update
        FROM stock s
        LEFT JOIN office o ON s.office_id = o.id
        LEFT JOIN menu m ON s.menu_id = m.id
        LEFT JOIN orders ob ON s.order_id = ob.id
    </select>

    <!-- StockHeader 삽입 -->
    <insert id="insertStockHeader" parameterType="com.kiosk.stock.header.DTO.StockHeaderDTO" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO stock (office_id, menu_id, order_id, quantity, is_use)
        VALUES (
            #{officeId},
            #{menuId},
            #{orderId},
            #{quantity},
            #{isUse}
        )
    </insert>

    <!-- StockHeader 업데이트 -->
    <update id="updateStockHeader" parameterType="com.kiosk.stock.header.DTO.StockHeaderDTO">
        UPDATE stock
        SET
            office_id = #{officeId},
            menu_id = #{menuId},
            order_id = #{orderId},
            quantity = #{quantity},
            is_use = #{isUse}
        WHERE id = #{id}
    </update>

    <!-- StockHeader 삭제 -->
    <delete id="deleteStockHeader" parameterType="int">
        DELETE FROM stock WHERE id = #{id}
    </delete>

</mapper>
