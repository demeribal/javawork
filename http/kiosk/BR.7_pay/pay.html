<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/857/857718.png" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì•„ì´ìŠ¤í¬ë¦¼ ìƒµ ê²°ì œ</title>
    <!-- í† ìŠ¤í˜ì´ë¨¼ì¸  SDK ì¶”ê°€ -->
    <script src="https://js.tosspayments.com/v2/standard"></script>
    <link href="https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
    <style>
      /* ========== ì „ì²´ ë ˆì´ì•„ì›ƒ ê°œì„  ========== */
      body {
        background: linear-gradient(135deg, #fff5f5 0%, #f8f5ff 100%);
        font-family: 'Pretendard', sans-serif;
        padding: 40px;
        display: flex;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
      }

      .payment-container {
        width: 1024px;
        height: auto;
        min-height: 1562px;
        background-color: #fff;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 30px;
        position: relative;
        overflow: hidden;
        border: 1px solid #ffe6f2;
      }

      .payment-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 8px;
        background: linear-gradient(90deg, #ff85a2, #ff9eb5);
      }

      /* ========== ì•Œë¦¼ ë°•ìŠ¤ ë””ìì¸ ì—…ê·¸ë ˆì´ë“œ ========== */
      .alert {
        background: linear-gradient(to right, #fff0f5, #ffe6f2);
        color: #d23c72;
        padding: 20px 25px;
        border-radius: 12px;
        font-size: 20px;
        margin-bottom: 30px;
        border: 1px solid #ffd6e7;
        position: relative;
        width: 90%;
        box-shadow: 0 4px 12px rgba(210, 60, 114, 0.05);
        transition: all 0.3s ease;
      }

      .alert:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(210, 60, 114, 0.1);
      }

      .alert .close-btn {
        position: absolute;
        right: 20px;
        top: 20px;
        cursor: pointer;
        font-weight: bold;
        color: #d23c72;
        background: none;
        border: none;
        font-size: 22px;
        transition: transform 0.3s ease;
      }

      .alert .close-btn:hover {
        transform: rotate(90deg);
      }

      /* ========== ì„¹ì…˜ íƒ€ì´í‹€ ë””ìì¸ ========== */
      .section-title {
        font-weight: 700;
        font-size: 42px;
        margin-bottom: 25px;
        align-self: flex-start;
        color: #2a2a2a;
        position: relative;
        padding-bottom: 10px;
      }

      .section-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 4px;
        background: linear-gradient(90deg, #ff85a2, #ff9eb5);
        border-radius: 2px;
      }

      /* ========== ê²°ì œ ë°©ë²• ì„ íƒ ì˜ì—­ ========== */
      .methods {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 25px;
        margin-bottom: 30px;
        width: 100%;
      }

      .method {
        width: 100%;
        height: 100px;
        display: flex;
        justify-content: center;
        align-items: center;
        border: 2px solid #f0e6ff;
        border-radius: 12px;
        background-color: #fff;
        cursor: pointer;
        padding: 15px;
        font-size: 18px;
        box-sizing: border-box;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.03);
      }

      .method:hover {
        border-color: #ff85a2;
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(255, 133, 162, 0.1);
      }

      .method.active {
        border: 3px solid #ff85a2;
        background-color: #fff5f9;
        box-shadow: 0 5px 15px rgba(255, 133, 162, 0.15);
        position: relative;
      }

      .method.active::after {
        content: 'âœ“';
        position: absolute;
        top: -10px;
        right: -10px;
        width: 25px;
        height: 25px;
        background: #ff85a2;
        color: white;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 14px;
      }

      .method img {
        max-width: 80%;
        max-height: 40px;
        object-fit: contain;
        transition: transform 0.3s ease;
      }

      .method:hover img {
        transform: scale(1.1);
      }

      /* ========== í˜œíƒ ë°•ìŠ¤ ë””ìì¸ ========== */
      .benefit-box {
        background: linear-gradient(to right, #fff5f9, #fff0f5);
        padding: 20px;
        border-radius: 12px;
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 15px;
        width: 90%;
        margin-top: 30px;
        align-self: flex-start;
        border: 1px solid #ffd6e7;
        box-shadow: 0 4px 12px rgba(255, 133, 162, 0.05);
      }

      .card-logo {
        width: 30px;
        height: 30px;
        object-fit: contain;
        margin-right: 10px;
      }

      /* ========== ì„ íƒ ë°•ìŠ¤ ë””ìì¸ ========== */
      .select-box {
        background-color: #fff9fb;
        border-radius: 10px;
        padding: 16px;
        font-size: 20px;
        width: 60%;
        border: 1px solid #ffd6e7;
        color: #555;
        align-self: flex-start;
        transition: all 0.3s ease;
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ff85a2'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 15px center;
        background-size: 20px;
      }

      .select-box:focus {
        border-color: #ff85a2;
        box-shadow: 0 0 0 3px rgba(255, 133, 162, 0.2);
        outline: none;
      }

      .select-box option {
        color: #333;
        padding: 10px;
      }

      /* ========== ì •ë³´ ë§í¬ ë””ìì¸ ========== */
      .info-link {
        font-size: 18px;
        margin-bottom: 30px;
        width: 90%;
        padding: 0;
        align-self: flex-start;
      }

      .info-link a {
        color: #ff85a2;
        text-decoration: none;
        font-weight: 600;
        position: relative;
        transition: all 0.3s ease;
      }

      .info-link a::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 0;
        height: 2px;
        background: #ff85a2;
        transition: width 0.3s ease;
      }

      .info-link a:hover::after {
        width: 100%;
      }

      /* ========== ì²´í¬ë°•ìŠ¤ ë””ìì¸ ========== */
      .checkbox {
        margin: 20px 0;
        font-size: 18px;
        width: 90%;
        display: flex;
        align-items: center;
      }

      .checkbox input[type="checkbox"] {
        -webkit-appearance: none;
        appearance: none;
        width: 22px;
        height: 22px;
        border: 2px solid #ffd6e7;
        border-radius: 5px;
        margin-right: 15px;
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .checkbox input[type="checkbox"]:checked {
        background-color: #ff85a2;
        border-color: #ff85a2;
      }

      .checkbox input[type="checkbox"]:checked::after {
        content: 'âœ“';
        position: absolute;
        color: white;
        font-size: 14px;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      /* ========== ì œì¶œ ë²„íŠ¼ ë””ìì¸ ========== */
      .submit-btn {
        width: 90%;
        background: linear-gradient(135deg, #ff85a2, #ff9eb5);
        color: white;
        font-size: 22px;
        font-weight: 600;
        padding: 22px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        box-shadow: 0 5px 15px rgba(255, 133, 162, 0.3);
        position: relative;
        overflow: hidden;
      }

      .submit-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(255, 133, 162, 0.4);
      }

      .submit-btn:active {
        transform: translateY(0);
      }

      .submit-btn::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          to bottom right,
          rgba(255, 255, 255, 0.3),
          rgba(255, 255, 255, 0)
        );
        transform: rotate(30deg);
        animation: shine 3s infinite;
      }

      @keyframes shine {
        0% { left: -50%; top: -50%; }
        100% { left: 150%; top: 150%; }
      }

      /* ========== ì•„ì´ìŠ¤í¬ë¦¼ ì•„ì´ì½˜ ë””ìì¸ ========== */
      .icecream-icon {
        position: absolute;
        opacity: 0.1;
        z-index: 0;
      }

      .icon-1 {
        top: 50px;
        right: 50px;
        width: 100px;
        height: 100px;
      }

      .icon-2 {
        bottom: 100px;
        left: 50px;
        width: 80px;
        height: 80px;
      }

      /* ========== ë°˜ì‘í˜• ë””ìì¸ ========== */
      @media (max-width: 1024px) {
        .methods {
          grid-template-columns: repeat(2, 1fr);
        }
        
        .select-box {
          width: 90%;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 20px;
        }
        
        .payment-container {
          padding: 30px 20px;
        }
        
        .methods {
          grid-template-columns: 1fr;
        }
        
        .method {
          height: 80px;
        }
      }

      /* í˜ì´ë“œì¸ ì• ë‹ˆë©”ì´ì…˜ */
      body {
        opacity: 0;
        animation: fadeIn 0.5s ease-out forwards;
      }

      @keyframes fadeIn {
        to { opacity: 1; }
      }

      /* í™œì„± íƒ­ ìŠ¤íƒ€ì¼ */
      .right_tab {
        color: #ff85a2;
        background-color: #fff;
      }

      /* í™œì„± íƒ­ í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼ - ë„¤ë¹„ê²Œì´ì…˜ì˜ active ìŠ¤íƒ€ì¼ ì ìš© */
      .right_tab::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 60%;
        height: 4px;
        background: #ff85a2;
        border-radius: 2px;
      }
    </style>
  </head>

  <body>
    <!-- ì£¼ë¬¸ì„œ ì˜ì—­ -->
    <div class="payment-container">
      <!-- ì•„ì´ìŠ¤í¬ë¦¼ ì•„ì´ì½˜ ë°ì½”ë ˆì´ì…˜ -->
      <svg class="icecream-icon icon-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7 8H17C17 6.89543 16.1046 6 15 6H9C7.89543 6 7 6.89543 7 8Z" fill="#FF85A2"/>
        <path d="M7 8L5 18H19L17 8H7Z" fill="#FFB6C1"/>
        <path d="M12 16C13.1046 16 14 15.1046 14 14V10C14 8.89543 13.1046 8 12 8C10.8954 8 10 8.89543 10 10V14C10 15.1046 10.8954 16 12 16Z" fill="#FF85A2"/>
      </svg>
      
      <svg class="icecream-icon icon-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7 8H17C17 6.89543 16.1046 6 15 6H9C7.89543 6 7 6.89543 7 8Z" fill="#FF85A2"/>
        <path d="M7 8L5 18H19L17 8H7Z" fill="#FFB6C1"/>
        <path d="M12 16C13.1046 16 14 15.1046 14 14V10C14 8.89543 13.1046 8 12 8C10.8954 8 10 8.89543 10 10V14C10 15.1046 10.8954 16 12 16Z" fill="#FF85A2"/>
      </svg>

      <h1 class="section-title">ì•„ì´ìŠ¤í¬ë¦¼ ì£¼ë¬¸ ê²°ì œ</h1>
      
      <div class="alert">
        ğŸ¦ ì£¼ë¬¸í•˜ì‹  ì•„ì´ìŠ¤í¬ë¦¼ì´ ë…¹ì§€ ì•Šë„ë¡ ë¹ ë¥´ê²Œ ê²°ì œí•´ì£¼ì„¸ìš”!
        <button class="close-btn">&times;</button>
      </div>
      
      <div class="wrapper" style="margin: 0 auto; width: 90%;">
        <div class="box_section" style="padding: 30px; margin-top: 20px; margin-bottom: 30px; background: #fff9fb; border-radius: 15px; border: 1px solid #ffd6e7;">
          <!-- ê²°ì œ UI -->
          <div id="payment-method"></div>
          <!-- ì´ìš©ì•½ê´€ UI -->
          <div id="agreement"></div>
          <!-- ì¿ í° ì²´í¬ë°•ìŠ¤ -->
          <div style="padding-left: 25px">
            <div class="checkbox">
              <label for="coupon-box">
                <input id="coupon-box" type="checkbox" aria-checked="true" />
                <span>1,000ì› ì•„ì´ìŠ¤í¬ë¦¼ ì¿ í° ì ìš©</span>
              </label>
            </div>
          </div>
          <!-- ê²°ì œí•˜ê¸° ë²„íŠ¼ -->
          <button class="submit-btn" id="payment-button">
            ğŸ¦ ì£¼ë¬¸ ê²°ì œí•˜ê¸°
          </button>
        </div>
      </div>
    </div>

    <script>
      main();

      async function main() {
        const button = document.getElementById("payment-button");
        const coupon = document.getElementById("coupon-box");
        // ì„¸ì…˜ ê°’ ê°€ì ¸ì˜¤ê¸°
        const priceData = JSON.parse(sessionStorage.getItem("priceData")) || {};
        const productData = JSON.parse(sessionStorage.getItem("productData")) || [];

        const amount = {
          currency: "KRW",
          value: priceData.paymentPrice || 0
        };
        
        const paycode = "ICECREAM-" + Date.now();
        const method = encodeURI("ì¹´ë“œ");

        const orderName = productData.map(p => p.name).join(', ') || "ì•„ì´ìŠ¤í¬ë¦¼ ì£¼ë¬¸";
        const flavors = productData.map(p => p.flavors).join(',') || "ë§› ì„ íƒ";

        const clientKey = "test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm";
        const customerKey = generateRandomString();
        const tossPayments = TossPayments(clientKey);
        // íšŒì› ê²°ì œ
        const widgets = tossPayments.widgets({
          customerKey,
        });

        await widgets.setAmount(amount);

        await widgets.renderPaymentMethods({
          selector: "#payment-method",
          variantKey: "DEFAULT",
        });

        await widgets.renderAgreement({ selector: "#agreement", variantKey: "AGREEMENT" });

        coupon.addEventListener("change", async function () {
          if (coupon.checked) {
            await widgets.setAmount({
              currency: "KRW",
              value: amount.value - 1000,
            });

            return;
          }

          await widgets.setAmount({
            currency: "KRW",
            value: amount,
          });
        });

        button.addEventListener("click", async function () {
          await widgets.requestPayment({
            orderId: paycode,
            orderName: orderName,
            successUrl: `http://www.baskinjohn.store/kiosk/BR.7_pay/pay-success.html` +
            `?paycode=${paycode}`+
            `&amount=${amount.value}`+
            `&method=${method}`+
            `&history=${orderName}`+
            `&flavors=${flavors}`,
            failUrl: `http://www.baskinjohn.store/kiosk/BR.7_pay/pay-fail.html`,
          });
        });
      }

      function generateRandomString() {
        return window.btoa(Math.random()).slice(0, 20);
      }
    </script>
  </body>
</html>