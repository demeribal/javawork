<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kiosk.stock.branch.mapper.StockBranchMapper">

    <resultMap id="stockBranchResultMap" type="com.kiosk.stock.branch.DTO.StockBranchDTO">
        <id property="id" column="id"/>
        <result property="menuId" column="menu_id"/>
        <result property="officeId" column="office_id"/>
        <result property="quantity" column="quantity"/>
        <result property="isUse" column="is_use"/>
        <result property="officeName" column="office_name"/>
        <result property="menuName" column="menuName"/>
        <result property="imagePath" column="imagePath"/>
        <result property="status" column="status"/>
    </resultMap>

    <!-- StockBranch 단건 조회 (stock.id 기준) -->
    <select id="getStockBranchById" parameterType="int" resultMap="stockBranchResultMap">
        SELECT
            s.id,
            s.menu_id,
            s.office_id,
            s.quantity,
            s.is_use,
            o.office_name,
            m.menuName,
            m.imagePath,
            ob.status
        FROM stock s
        LEFT JOIN office o ON s.office_id = o.id
        LEFT JOIN menu m ON s.menu_id = m.id
        LEFT JOIN orders ob ON s.order_id = ob.id
        WHERE s.id = #{id}
    </select>

    <!-- StockBranch 전체 조회 -->
    <select id="getAllStockBranches" resultMap="stockBranchResultMap">
        SELECT
            s.id,
            s.menu_id,
            s.office_id,
            s.quantity,
            s.is_use,
            o.office_name,
            m.menuName,
            m.imagePath,
            ob.status
        FROM stock s
        LEFT JOIN office o ON s.office_id = o.id
        LEFT JOIN menu m ON s.menu_id = m.id
        LEFT JOIN orders ob ON s.order_id = ob.id
    </select>

    <!-- officeId로 StockBranch 조회 -->
    <select id="getStockBranchesByOfficeId" parameterType="int" resultMap="stockBranchResultMap">
        SELECT
            s.id,
            s.menu_id,
            s.office_id,
            s.quantity,
            s.is_use,
            o.office_name,
            m.menuName,
            m.imagePath,
            ob.status
        FROM stock s
        LEFT JOIN office o ON s.office_id = o.id
        LEFT JOIN menu m ON s.menu_id = m.id
        LEFT JOIN orders ob ON s.order_id = ob.id
        WHERE s.office_id = #{officeId}
    </select>

    <!-- menuId로 StockBranch 조회 -->
    <select id="getStockBranchesByMenuId" parameterType="int" resultMap="stockBranchResultMap">
        SELECT
            s.id,
            s.menu_id,
            s.office_id,
            s.quantity,
            s.is_use,
            o.office_name,
            m.menuName,
            m.imagePath,
            ob.status
        FROM stock s
        LEFT JOIN office o ON s.office_id = o.id
        LEFT JOIN menu m ON s.menu_id = m.id
        LEFT JOIN orders ob ON s.order_id = ob.id
        WHERE s.menu_id = #{menuId}
    </select>

    <!-- StockBranch 삽입 -->
    <insert id="insertStockBranch" parameterType="com.kiosk.stock.branch.DTO.StockBranchDTO" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO stock (
            menu_id,
            office_id,
            quantity,
            is_use
        ) VALUES (
            #{menuId},
            #{officeId},
            #{quantity},
            #{isUse}
        )
    </insert>

    <!-- StockBranch 업데이트 -->
    <update id="updateStockBranch" parameterType="com.kiosk.stock.branch.DTO.StockBranchDTO">
        UPDATE stock
        SET
            menu_id = #{menuId},
            office_id = #{officeId},
            quantity = #{quantity},
            is_use = #{isUse}
        WHERE id = #{id}
    </update>

    <!-- StockBranch 삭제 -->
    <delete id="deleteStockBranch" parameterType="int">
        DELETE FROM stock WHERE id = #{id}
    </delete>

</mapper>
